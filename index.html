<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AI Image Inpainting</title>
    <style>
        img {
            max-width: 600px;
            margin-bottom: 20px;
        }
        canvas {
            display: none;
        }
    </style>
</head>
<body>
    <h1>AI Image Inpainting</h1>
    <input type="file" id="file-input" accept="image/*">
    <br>
    <canvas id="canvas"></canvas>
    <img id="image-preview">
    <br>
    <button id="inpaint-button" disabled>Inpaint Image</button>
    <script src="https://cdn.jsdelivr.net/npm/@openai/openai-js-sdk@1.0.1/dist/openai-js-sdk.umd.js"></script>
    <script>
        const encodedString = "c2std3lKMnZKdWN4VjhLTDRzUnRNTkJUM0JsYmtGSklrUFR3eWZkRkZZQXZsT2QwM3pj";
        const decodedString = atob(encodedString);
        const openaiApiKey = decodedString;
        const openaiEndpoint = "https://api.openai.com/v1/engines/davinci/completions";
        const openaiModel = "text-davinci-002";
        const fileInput = document.getElementById("file-input");
        const canvas = document.getElementById("canvas");
        const imagePreview = document.getElementById("image-preview");
        const inpaintButton = document.getElementById("inpaint-button");

        fileInput.addEventListener("change", function() {
            const file = fileInput.files[0];
            if (file.type.match(/^image\//)) {
                const reader = new FileReader();
                reader.onload = function() {
                    const img = new Image();
                    img.onload = function() {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0);
                        imagePreview.src = canvas.toDataURL();
                        inpaintButton.disabled = false;
                    };
                    img.src = reader.result;
                };
                reader.readAsDataURL(file);
            } else {
                alert("Please choose an image file.");
            }
        });

        inpaintButton.addEventListener("click", function() {
            inpaintButton.disabled = true;
            const ctx = canvas.getContext("2d");
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const base64Data = canvas.toDataURL().split(",")[1];
            const openaiClient = new OpenAI({
                apiKey: openaiApiKey,
            });
            openaiClient.completions.create({
                engine: "davinci",
                prompt: `Please complete the image: ${base64Data}`,
                maxTokens: 512,
                n: 1,
                stop: ["\n"],
                temperature: 0.5,
                presencePenalty: 0,
                frequencyPenalty: 0,
            })
            .then(response => {
                const result = response.choices[0].text.trim();
                const img = new Image();
                img.onload = function() {
                    ctx.drawImage(img, 0, 0);
                    imagePreview.src = canvas.toDataURL();
                    inpaintButton.disabled = false;
                };
                img.src = result;
            })
            .catch(error => {
                console.error(error);
                inpaintButton.disabled = false;
            });
        });
    </script>
</body>
</html>
